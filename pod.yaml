apiVersion: v1
kind: Pod
metadata:
  name: graceful-shutdown
spec:
  containers:
    - name: graceful-shutdown
      image: node:erbium
      command:
        - node
        - /app/index.js
      env:
        - name: SLACK_TOKEN
          valueFrom:
            secretKeyRef:
              name: slack-auth
              key: token
      volumeMounts:
        - name: script-file
          mountPath: /app
      lifecycle:
        preStop:
          exec:
            command:
              - node
              - /app/preStop.js
  volumes:
    - name: script-file
      configMap:
        name: script-file
  terminationGracePeriodSeconds: 15
  restartPolicy: Never
